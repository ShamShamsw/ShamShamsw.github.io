<script>
    const orders = [];
    const products = [
        { id: "robot001", name: "Cleaning Robot", description: "A robot that cleans your house.", stock: 500 },
        { id: "robot002", name: "Cooking Robot", description: "A robot that cooks meals.", stock: 500 }
    ];

    const orderBtn = document.getElementById('order-btn');
    const orderPopup = document.getElementById('order-popup');
    const closePopupButtons = document.querySelectorAll('.close-popup');
    const orderForm = document.getElementById('order-form');
    const fetchOrderBtn = document.getElementById('fetch-order-btn');
    const fetchOrderPopup = document.getElementById('fetch-order-popup');
    const orderDetailsDiv = document.getElementById('order-details');
    const fetchProductBtn = document.getElementById('fetch-product-btn');
    const fetchProductPopup = document.getElementById('fetch-product-popup');
    const getProductInfoBtn = document.getElementById('get-product-info-btn');
    const productIdInput = document.getElementById('product-id-input');
    const fetchInventoryBtn = document.getElementById('get-inventory-btn');
    const fetchInventoryPopup = document.getElementById('fetch-inventory-popup');
    const inventoryDetailsDiv = document.getElementById('inventory-details');
    const addProductBtn = document.getElementById('add-product-btn');
    const productInputsContainer = document.getElementById('product-inputs-container');

    let productCount = 1;

    orderBtn.addEventListener('click', () => {
        orderPopup.classList.add('show');
    });

    fetchOrderBtn.addEventListener('click', () => {
        fetchOrderPopup.classList.add('show');
        if (orders.length > 0) {
            const latestOrder = orders[orders.length - 1];
            orderDetailsDiv.innerText = JSON.stringify(latestOrder, null, 2);
        } else {
            orderDetailsDiv.innerText = "No orders available.";
        }
    });

    fetchProductBtn.addEventListener('click', () => {
        fetchProductPopup.classList.add('show');
    });

    fetchInventoryBtn.addEventListener('click', () => {
        const inventoryDetails = products.map(product => {
            return `${product.name} (ID: ${product.id}) - Stock: ${product.stock}`;
        }).join("\n");
        inventoryDetailsDiv.innerText = inventoryDetails;
    });

    closePopupButtons.forEach(button => {
        button.addEventListener('click', () => {
            let popup = button.closest('.popup');
            if (popup) {
                popup.classList.remove('show');
            }
        });
    });

    orderForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const customerId = orderForm.customerId.value;
        const productIds = document.querySelectorAll('input[name="productId[]"]');
        const quantities = document.querySelectorAll('input[name="quantity[]"]');
        const items = [];

        productIds.forEach((input, index) => {
            if (input.value) {
                const quantityValue = parseInt(quantities[index].value);
                if (quantityValue > 0) {
                    items.push({
                        productId: input.value,
                        quantity: quantityValue,
                    });
                }
            }
        });

        const orderData = {
            id: `order${orders.length + 1}`,
            customerId: customerId,
            items: items,
            orderNumber: `ORD-${new Date().getTime()}` // Unique order number based on timestamp
        };

        orders.push(orderData);
        alert('Order created successfully! Order ID: ' + orderData.id + '\nOrder Number: ' + orderData.orderNumber);
        orderForm.reset();
        orderPopup.classList.remove('show');
    });

    addProductBtn.addEventListener('click', () => {
        productCount++;
        const newProductInput = document.createElement('div');
        newProductInput.classList.add('product-input-group');
        newProductInput.innerHTML = `
            <label for="product-id-${productCount}">Product ${productCount} ID:</label>
            <input type="text" id="product-id-${productCount}" name="productId[]" class="product-input" placeholder="Enter Product ID" required><br>
            <label for="quantity-${productCount}">Quantity ${productCount}:</label>
            <input type="number" id="quantity-${productCount}" name="quantity[]" class="quantity-input" value="1" min="1" required><br><br>
        `;
        productInputsContainer.appendChild(newProductInput);
    });
</script>
